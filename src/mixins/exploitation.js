import { mapGetters, mapActions } from 'vuex'
import { latLng } from "leaflet"
export default {
    data() {
        return {
            exploitationDetail: null,
            otherExploitations: null,
        }
    },
    computed: {
        ...mapGetters('exploitation', ['exploitations', 'selectedExploitations']),
        hasSelection() {
            return this.selectedExploitations.length > 0
        },
    },
    methods: {
        async getExploitationsSummary() {
            await this.axios.get('exploitations/summary')
                .then((res) => {
                    const temp = []
                    res.data.map((c) => {
                        c.selected = false
                        temp.push(c)
                    })
                    this.setExploitations(temp)
                })
                .catch((err) => {
                    console.log(err)
                })
        },
        async getExploitationDetails(idexploitation) {
            await this.axios.get(`exploitation/${idexploitation}`)
                .then(async (res) => {
                    res.data.gis[0].latLong = latLng(res.data.gis[0].lat, res.data.gis[0].long)
                    console.log(res.data)
                    this.exploitationDetail = res.data
                    this.getOtherExploitations(res.data.idexploitant)
                })
                .catch((err) => {
                    console.log(err)
                    this.exploitationDetail = null
                })
        },
        async getOtherExploitations(idexploitant) {
            await this.axios.get(`/exploitation/exploitant/${idexploitant}`)
                .then((res) => {
                    this.otherExploitations = res.data
                })
                .catch((err) => {
                    console.log(err)  
                    this.otherExploitations = null                  
                })
        },
        isSelected(id) {
            return this.selectedExploitations.some((e) => e.idexploitation === id)
        },
        getExploitation(idexploitation) {
            return this.exploitations.find((e) => e.idexploitation === idexploitation)
        },
        ...mapActions('exploitation', ['setExploitations', 'selectExploitation', 'selectExploitations', 'selectAll', 'clearSelection'])
    }
}