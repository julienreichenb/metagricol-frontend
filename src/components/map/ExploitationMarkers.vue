<template>
    <div v-if="zoom < 13">
        <l-circle-marker 
            v-for="e in exploitations" 
            :key="e.id" 
            :lat-lng="e.latLong"
            :radius="5"
        >
            <l-popup>
                <div class="custom-popup" v-html="popup(e)" />
            </l-popup>
        </l-circle-marker>
    </div>
    <div v-else>
        <l-marker 
            v-for="e in filterItems" 
            :key="e.id" 
            :lat-lng="e.latLong"
        >
            <l-icon>
                <font-awesome-layers :class="zoom > 14 ? 'fa-3x' : 'fa-2x'">
                    <font-awesome-icon icon="circle" :color="icon.color" />
                    <font-awesome-icon icon="circle" color="white" transform="shrink-1" />
                    <font-awesome-icon :icon="icon.icon" :color="icon.color" transform="shrink-6" />
                </font-awesome-layers>
            </l-icon>
            <l-popup>
                <div class="custom-popup" v-html="popup(e)" />
            </l-popup>
        </l-marker>
    </div>
</template>

<script>
export default {
    props: {
        exploitations: { type: Array, default: null },
        selected: {  },
        bounds: { type: Object, required: true },
        zoom: { type: Number, required: true },
        icon: { type: Object, default () { return { icon: 'farm', color: 'firebrick' } } },
    },
    computed: {
        filterItems() {
            const filteredList = []
            this.exploitations.map((i) => {
                if(this.bounds.contains(i.latLong))
                    filteredList.push(i)
            })
            return filteredList
        },
    },
    methods: {
        popup(exploitation) {
            return `
                <b>${exploitation.exploitant}</b>
                <p>${exploitation.address}</p>
            `
        }
    }
}
</script>

<style lang="scss">
.custom-popup {
    p {
        margin: 0;
    }
}
</style>