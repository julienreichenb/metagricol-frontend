<template>
    <div v-if="zoom < 13">
        <div v-for="e in exploitationsgis" 
            :key="e.id"
        >
            <l-circle-marker v-if="!hasSelection || isSelected(e.id)"
                :lat-lng="e.latLong"
                :radius="5"
                :color="hasSelection ? (isSelected(e.id) ? '#3388ff' : 'grey') : '#3388ff'"
                :opacity="hasSelection ? (isSelected(e.id) ? 1 : .2) : 1"
            >
                <l-popup>
                    <div class="custom-popup" v-html="popup(e)" />
                </l-popup>
            </l-circle-marker>
        </div>
    </div>
    <div v-else>
        <div v-for="e in inBoundItems" 
            :key="e.id"
        >
            <l-marker v-if="!hasSelection || isSelected(e.id)"
                :lat-lng="e.latLong"
            >
                <l-icon>
                    <font-awesome-layers :class="zoom > 14 ? 'fa-3x' : 'fa-2x'">
                        <font-awesome-icon icon="circle" :color="icon.color" />
                        <font-awesome-icon icon="circle" color="white" transform="shrink-1" />
                        <font-awesome-icon :icon="icon.icon" :color="icon.color" transform="shrink-6" />
                    </font-awesome-layers>
                </l-icon>
                <l-popup>
                    <div class="custom-popup" v-html="popup(e)" />
                </l-popup>
            </l-marker>
        </div>
    </div>
</template>

<script>
import ExploitationMixin from '@/mixins/exploitation'
export default {
    mixins: [ExploitationMixin],
    props: {
        exploitationsgis: { type: Array, default: null },
        bounds: { type: Object, required: true },
        zoom: { type: Number, required: true },
        icon: { type: Object, default () { return { icon: 'farm', color: 'firebrick' } } },
    },
    computed: {
        inBoundItems() {
            const filteredList = []
            this.exploitationsgis.map((i) => {
                if(this.bounds.contains(i.latLong))
                    filteredList.push(i)
            })
            return filteredList
        },
    },
    methods: {
        popup(exploitation) {
            return `
                <b><i>${exploitation.noct}</i></b>
                <hr />
                <b>${exploitation.exploitant}</b>
                <p>${exploitation.address}</p>
            `
        },
    }
}
</script>

<style lang="scss">
.custom-popup {
    p {
        margin: 0;
    }
    hr {
        margin: 7px 0;
    }
}
</style>