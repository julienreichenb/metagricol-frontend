<template>
  <div class="w-100 border border-dark">
        <l-map
            style="height: 350px"
            :zoom="zoom"
            :center="center"
            :options="mapOptions"
            @update:center="centerUpdate"
            @update:zoom="zoomUpdate"
            @update:bounds="boundsUpdate"
        >
            <l-tile-layer
                :url="url"
                :attribution="attribution"
            />
            <l-circle-marker
                :lat-lng="exploitationgis.latLong"
            />  
            <div v-for="p in parcels" :key="p.idparcel">
                <l-geo-json v-if="p.gis.length && p.gis[0].geojson"
                    :geojson="JSON.parse(p.gis[0].geojson)"
                />
            </div>
        </l-map>
    </div>
</template>

<script>
import { latLng } from "leaflet"
import MapMixin from '@/mixins/map'
export default {
    mixins: [MapMixin],
    props: {
        exploitationgis: { type: Object, required: true },
        parcels: { type: Array, required: false },
    },
    data() {
        return {
            url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
            attribution:
                '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
            zoom: 9.5,
            center: latLng(46.1707967, 7.6220283),
            bounds: {
                _northEast: latLng(46.92588289494367, 9.014282226562502),
                _southWest: latLng(45.77135470445038, 6.231994628906251)
            },
            currentZoom: null,
            currentCenter: null,
            currentBounds: null,
            mapOptions: {
                zoomSnap: 0.5,
                zoomControl: false,
            },  
        }
    },
    created() {
        this.init()
    },
    methods: {
        init() {
            this.center = this.exploitationgis.latLong
            this.currentZoom = this.zoom
            this.currentCenter = this.center
            this.currentBounds = this.bounds
        },
        zoomUpdate(zoom) {
            this.currentZoom = zoom
        },
        centerUpdate(center) {
            this.currentCenter = center
        },
        boundsUpdate(bounds) {
            this.currentBounds = bounds
        },
    }
}
</script>

<style>

</style>