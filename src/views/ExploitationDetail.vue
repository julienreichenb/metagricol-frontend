<template>
  <div id="exploitation-detail">
    <router-link
      :to="$i18nRoute({ name: 'Dashboard' })"
    >
      <font-awesome-icon icon="angle-double-left" class="mr-1" />
      <span v-html="$t(tKey + 'back')" />
    </router-link>
    <div class="mt-3" v-if="exploitationDetail">
      <b-card no-body class="mb-4">
        <b-card-header class="bg-dark text-white">
          <h2>
            {{ $t(tKey + 'exploitation' )}} -
            <i>NÂ° {{ exploitationDetail.noctexploitation }}</i>
          </h2>
        </b-card-header>
        <b-card-body>
          <b-row class="text-left">
            <b-col md="12" lg="6">
              <ExploitantCard 
                :exploitant="exploitationDetail.exploitant"
              />
              <ContactCard 
                :email="exploitationDetail.email ? exploitationDetail.email : exploitationDetail.emailscapd"
                :phoneprivate="exploitationDetail.phoneprivate"  
                :phonemobile="exploitationDetail.phonemobile" 
                :address="exploitationDetail.gis[0].address"
              />
              <div class="mt-5">
                <b-row class="lead">
                  <b-col>
                    <span v-html="$t(tKey + 'hasCattle')" class="mr-3"
                      :class="exploitationDetail.ugbs.length ? 'font-weight-bold' : 'text-muted'"
                    />
                    <font-awesome-icon 
                      :icon="exploitationDetail.ugbs.length ? ['fad', 'check-circle'] : ['fad', 'times-circle']"
                      :color="exploitationDetail.ugbs.length ? 'green' : 'red'"
                    />
                  </b-col>
                  <b-col>
                    <span v-html="$t(tKey + 'hasMilk')" class="mr-3" 
                      :class="exploitationDetail.milksells.length ? 'font-weight-bold' : 'text-muted'"
                    />
                    <font-awesome-icon 
                      :icon="exploitationDetail.milksells.length ? ['fad', 'check-circle'] : ['fad', 'times-circle']"
                      :color="exploitationDetail.milksells.length ? 'green' : 'red'"
                    />
                  </b-col>
                </b-row>
              </div>
            </b-col>
            <b-col>
              <ExploitationMap 
                :exploitationgis="exploitationDetail.gis[0]"
                :parcels="exploitationDetail.parcels"
              />
            </b-col>
          </b-row>
        </b-card-body>
        <b-button class="rounded-0"
          v-b-toggle.collapse-info
          block
          variant="primary"
        >
          <font-awesome-icon :icon="['fad', 'info-circle']" class="mr-1" />
          <span v-html="$t(tKey + 'moreInfo')" />
        </b-button>
        <b-collapse id="collapse-info" class="my-2">
          <MoreInfo :exploitation="exploitationDetail" :otherExploitations="otherExploitations" />
        </b-collapse>
      </b-card>
      <b-row no-gutters>
        <CattleDetails v-if="exploitationDetail.ugbs.length" :hasMilk="exploitationDetail.milksells.length > 0" :cattleDetail="exploitationDetail.ugbs" />
        <MilkDetails v-if="exploitationDetail.milksells.length" :hasCattle="exploitationDetail.ugbs.length > 0" :milkDetail="exploitationDetail.milksells" />
      </b-row>
      <ParcelDetails v-if="exploitationDetail.parcels.length" :parcels="exploitationDetail.parcels" />
    </div>
    <loading v-else />
  </div>
</template>

<script>
import ExploitantCard from '@/components/detail/ExploitantCard'
import ContactCard from '@/components/detail/ContactCard'
import MoreInfo from '@/components/detail/MoreInfo'
import ParcelDetails from '@/components/detail/ParcelDetails'
import CattleDetails from '@/components/detail/CattleDetails'
import MilkDetails from '@/components/detail/MilkDetails'
import ExploitationMap from '@/components/map/ExploitationMap'
import ExploitationMixin from '@/mixins/exploitation'
export default {
  components: {
    ExploitantCard,
    ContactCard,
    MoreInfo,
    ParcelDetails,
    CattleDetails,
    MilkDetails,
    ExploitationMap,
  },
  mixins: [ExploitationMixin],
  data() {
    return {
      tKey: 'detail.',
    }
  },
  created() {
    this.getExploitationDetails(this.$route.params.idexploitation)
  },
}
</script>

<style lang="scss">
#exploitation-detail {
  span {
    margin-right: 3px;
  }
  p {
    margin-bottom: 4px;
  }
}

</style>